<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nebura-control documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">nebura-control documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >FileUploadService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/interfaces/http/routes/users/service/multer.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Service for file upload and management.</p>
<p>Handles file upload, retrieval, update, and deletion logic.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const file = await fileUploadService.handleFileUpload(multerFile, userUuid);
const metadata = await fileUploadService.getFileById(1);
const files = await fileUploadService.getAllFiles();
const updated = await fileUploadService.updateFile(1, { name: &quot;new.txt&quot; });
const deleted = await fileUploadService.deleteFile(1);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none">See {&#64;link https://docs.nestjs.com/providers NestJS Providers}
See {&#64;link https://typeorm.io/#/repository-api TypeORM Repository API}
See {&#64;link https://github.com/colinhacks/zod Zod Validation}
See {&#64;link https://docs.nestjs.com/techniques/validation NestJS Validation}
See {&#64;link https://github.com/typestack/class-validator class-validator}</code></pre></div>
            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logger" >logger</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteFile" >deleteFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteFileForUser" >deleteFileForUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#generateShareLink" >generateShareLink</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAllFiles" >getAllFiles</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAllFilesForUser" >getAllFilesForUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getFileById" >getFileById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getFileByIdForUser" >getFileByIdForUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getFileHistory" >getFileHistory</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#handleFileUpload" >handleFileUpload</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#replaceFile" >replaceFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateFile" >updateFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateFileForUser" >updateFileForUser</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(fileRepository: <a href="../entitys/FileEntity.html" target="_self">Repository&lt;FileEntity&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="39" class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:39</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Creates an instance of FileUploadService.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>fileRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/FileEntity.html" target="_self" >Repository&lt;FileEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <p>TypeORM repository for FileEntity.</p>

                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>deleteFile</b></span>
                        <a href="#deleteFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteFile(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="278"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:278</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Deletes a file by its ID.</p>
<p>Removes the file record from the database.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const deleted = await fileUploadService.deleteFile(1);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none"></code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>True if deleted, false otherwise.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteFileForUser"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>deleteFileForUser</b></span>
                        <a href="#deleteFileForUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteFileForUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="289"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:289</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="generateShareLink"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>generateShareLink</b></span>
                        <a href="#generateShareLink"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>generateShareLink(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="404"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:404</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Generates a temporary share link for a file.</p>
<p>Creates a unique token and returns a link for temporary download.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>User UUID.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Temporary share link or null if file not found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAllFiles"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAllFiles</b></span>
                        <a href="#getAllFiles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAllFiles()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="162"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:162</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves all files.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const files = await fileUploadService.getAllFiles();</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none"></code></pre></div></div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Array of file metadata.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAllFilesForUser"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAllFilesForUser</b></span>
                        <a href="#getAllFilesForUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAllFilesForUser(userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="167"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:167</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFileById"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getFileById</b></span>
                        <a href="#getFileById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFileById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="138"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:138</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves a file by its ID.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const file = await fileUploadService.getFileById(1);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none"></code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>File metadata or null if not found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFileByIdForUser"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getFileByIdForUser</b></span>
                        <a href="#getFileByIdForUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFileByIdForUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="145"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:145</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFileHistory"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getFileHistory</b></span>
                        <a href="#getFileHistory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFileHistory(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="383"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:383</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Returns the history (versions) of a file.</p>
<p>If versioning is not implemented, returns only the current version.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>User UUID.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Array of file versions metadata.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleFileUpload"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>handleFileUpload</b></span>
                        <a href="#handleFileUpload"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleFileUpload(file: Express.Multer.File, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="64"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:64</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Handles file upload.</p>
<p>Validates the file type and size, checks metadata with Zod, and saves the file metadata to the database.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const result = await fileUploadService.handleFileUpload(multerFile);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none"></code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>file</td>
                                            <td>
                                                        <code>Express.Multer.File</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The uploaded file from Multer.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Upload result with file metadata.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="replaceFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>replaceFile</b></span>
                        <a href="#replaceFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>replaceFile(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, file: Express.Multer.File, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="311"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:311</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Replaces the physical file for a given file ID and user UUID.</p>
<p>Deletes the old file from disk and saves the new one, updating metadata in the database.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>file</td>
                                            <td>
                                                        <code>Express.Multer.File</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>New file to replace the old one.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>User UUID.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Updated file metadata or null if not found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateFile</b></span>
                        <a href="#updateFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateFile(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, updateDto: <a href="../classess/UpdateMulterDto.html" target="_self">UpdateMulterDto</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="192"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:192</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates file metadata using UpdateMulterDto.</p>
<p>Validates update data with Zod and class-validator, then updates the file record in the database.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const updateDto = new UpdateMulterDto();
updateDto.name = &quot;new.txt&quot;;
const updated = await fileUploadService.updateFile(1, updateDto);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none">See {&#64;link https://docs.nestjs.com/techniques/validation NestJS Validation}
See {&#64;link https://typeorm.io/#/repository-api TypeORM Repository API}</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateDto</td>
                                            <td>
                                                            <code><a href="../classess/UpdateMulterDto.html" target="_self" >UpdateMulterDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>UpdateMulterDto instance containing partial file metadata.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Updated file or null if not found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateFileForUser"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>updateFileForUser</b></span>
                        <a href="#updateFileForUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateFileForUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, updateDto: <a href="../classess/UpdateMulterDto.html" target="_self">UpdateMulterDto</a>, userUuid: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="239"
                                    class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:239</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Updates file metadata for a specific user using UpdateMulterDto.</p>
<p>Validates update data with Zod and class-validator, then updates the file record in the database.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">```typescript
const updateDto = new UpdateMulterDto();
updateDto.name = &quot;new.txt&quot;;
const updated = await fileUploadService.updateFileForUser(1, updateDto, &quot;user-uuid&quot;);</code></pre></div><b>Example :</b><div><pre class="line-numbers"><code class="language-none">See {&#64;link https://docs.nestjs.com/techniques/validation NestJS Validation}
See {&#64;link https://typeorm.io/#/repository-api TypeORM Repository API}</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>File ID.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>updateDto</td>
                                            <td>
                                                            <code><a href="../classess/UpdateMulterDto.html" target="_self" >UpdateMulterDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>UpdateMulterDto instance containing partial file metadata.</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userUuid</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>UUID of the user associated with the file.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>Updated file or null if not found.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(FileUploadService.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="39" class="link-to-prism">src/interfaces/http/routes/users/service/multer.service.ts:39</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Logger instance for this service.</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { FileUploadSchema } from &quot;#adapters/schemas/files.schema&quot;;
import { FileEntity } from &quot;#entity/utils/file.entity&quot;;
import crypto from &quot;crypto&quot;;
import fs from &quot;fs/promises&quot;;
import path from &quot;path&quot;;
import { Repository } from &quot;typeorm&quot;;
import { ZodError } from &quot;zod&quot;;

import { BadRequestException, Injectable, Logger } from &quot;@nestjs/common&quot;;
import { InjectRepository } from &quot;@nestjs/typeorm&quot;;

import { UpdateMulterDto } from &quot;../dto/update-multer.dto&quot;;

/**
 * Service for file upload and management.
 *
 * Handles file upload, retrieval, update, and deletion logic.
 *
 * @example
 * &#x60;&#x60;&#x60;typescript
 * const file &#x3D; await fileUploadService.handleFileUpload(multerFile, userUuid);
 * const metadata &#x3D; await fileUploadService.getFileById(1);
 * const files &#x3D; await fileUploadService.getAllFiles();
 * const updated &#x3D; await fileUploadService.updateFile(1, { name: &quot;new.txt&quot; });
 * const deleted &#x3D; await fileUploadService.deleteFile(1);
 * &#x60;&#x60;&#x60;
 *
 * @see {@link https://docs.nestjs.com/providers NestJS Providers}
 * @see {@link https://typeorm.io/#/repository-api TypeORM Repository API}
 * @see {@link https://github.com/colinhacks/zod Zod Validation}
 * @see {@link https://docs.nestjs.com/techniques/validation NestJS Validation}
 * @see {@link https://github.com/typestack/class-validator class-validator}
 */
@Injectable()
export class FileUploadService {
  /**
   * Logger instance for this service.
   */
  private readonly logger &#x3D; new Logger(FileUploadService.name);

  /**
   * Creates an instance of FileUploadService.
   * @param fileRepository TypeORM repository for FileEntity.
   */
  constructor(
    @InjectRepository(FileEntity)
    private readonly fileRepository: Repository&lt;FileEntity&gt;,
  ) {}

  /**
   * Handles file upload.
   *
   * Validates the file type and size, checks metadata with Zod, and saves the file metadata to the database.
   *
   * @param file The uploaded file from Multer.
   * @returns Upload result with file metadata.
   * @throws {BadRequestException} If file is invalid.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const result &#x3D; await fileUploadService.handleFileUpload(multerFile);
   * &#x60;&#x60;&#x60;
   */
  async handleFileUpload(file: Express.Multer.File, userUuid: string) {
    this.logger.debug(&#x60;handleFileUpload called with file: ${file?.originalname}&#x60;);

    if (!file) {
      this.logger.warn(&quot;No file uploaded&quot;);
      throw new BadRequestException(&quot;no file uploaded&quot;, {
        description: &quot;Please upload a file to proceed.&quot;,
        cause: &quot;File upload is required&quot;,
      });
    }

    // Validate file type
    const allowedMimeTypes &#x3D; [&quot;image/jpeg&quot;, &quot;image/png&quot;, &quot;application/pdf&quot;];
    if (!allowedMimeTypes.includes(file.mimetype)) {
      this.logger.warn(&#x60;Invalid file type: ${file.mimetype}&#x60;);
      throw new BadRequestException(&quot;invalid file type&quot;, {
        description: &quot;Allowed file types are: JPEG, PNG, PDF.&quot;,
        cause: &quot;File type not supported&quot;,
      });
    }

    // Validate file size (max 5MB)
    const maxSize &#x3D; 5 * 1024 * 1024;
    if (file.size &gt; maxSize) {
      this.logger.warn(&#x60;File too large: ${file.size}&#x60;);
      throw new BadRequestException(&quot;file is too large!&quot;, {
        description: &quot;File size must be less than 5MB.&quot;,
        cause: &quot;File size exceeded&quot;,
      });
    }

    // Zod validation
    try {
      FileUploadSchema.parse({
        name: file.originalname,
        path: file.path,
        mimeType: file.mimetype,
        size: String(file.size),
        checksum: &quot;simulated-checksum&quot;, // You may want to calculate a real checksum
      });
    } catch (err) {
      this.logger.error(&quot;Zod validation failed&quot;, err instanceof ZodError ? err.message : err);
      throw new BadRequestException(&quot;File data validation failed&quot;, {
        description: &quot;File data does not match schema&quot;,
        cause: err,
      });
    }

    // Save to database
    const fileEntity &#x3D; this.fileRepository.create({
      name: file.originalname,
      path: file.path,
      mimeType: file.mimetype,
      size: String(file.size),
      checksum: &quot;simulated-checksum&quot;,
      userUuid, // Nuevo campo
    });
    await this.fileRepository.save(fileEntity);

    this.logger.log(&#x60;File uploaded and saved: ${fileEntity.id}&#x60;);
    return { message: &quot;File uploaded successfully&quot;, file: fileEntity };
  }

  /**
   * Retrieves a file by its ID.
   *
   * @param id File ID.
   * @returns File metadata or null if not found.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const file &#x3D; await fileUploadService.getFileById(1);
   * &#x60;&#x60;&#x60;
   */
  async getFileById(id: number) {
    this.logger.debug(&#x60;getFileById called with id: ${id}&#x60;);
    const file &#x3D; await this.fileRepository.findOne({ where: { id } });
    if (!file) this.logger.warn(&#x60;File not found: ${id}&#x60;);
    return file;
  }

  async getFileByIdForUser(id: number, userUuid: string) {
    this.logger.debug(&#x60;getFileByIdForUser called with id: ${id}, userUuid: ${userUuid}&#x60;);
    const file &#x3D; await this.fileRepository.findOne({ where: { id, userUuid } });
    if (!file) this.logger.warn(&#x60;File not found: ${id}&#x60;);
    return file;
  }

  /**
   * Retrieves all files.
   *
   * @returns Array of file metadata.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const files &#x3D; await fileUploadService.getAllFiles();
   * &#x60;&#x60;&#x60;
   */
  async getAllFiles() {
    this.logger.debug(&quot;getAllFiles called&quot;);
    return await this.fileRepository.find();
  }

  async getAllFilesForUser(userUuid: string) {
    this.logger.debug(&#x60;getAllFilesForUser called for userUuid: ${userUuid}&#x60;);
    return await this.fileRepository.find({ where: { userUuid } });
  }

  /**
   * Updates file metadata using UpdateMulterDto.
   *
   * Validates update data with Zod and class-validator, then updates the file record in the database.
   *
   * @param id File ID.
   * @param updateDto UpdateMulterDto instance containing partial file metadata.
   * @returns Updated file or null if not found.
   * @throws {BadRequestException} If update data is invalid.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const updateDto &#x3D; new UpdateMulterDto();
   * updateDto.name &#x3D; &quot;new.txt&quot;;
   * const updated &#x3D; await fileUploadService.updateFile(1, updateDto);
   * &#x60;&#x60;&#x60;
   *
   * @see {@link https://docs.nestjs.com/techniques/validation NestJS Validation}
   * @see {@link https://typeorm.io/#/repository-api TypeORM Repository API}
   */
  async updateFile(id: number, updateDto: UpdateMulterDto) {
    this.logger.debug(&#x60;updateFile called with id: ${id}, data: ${JSON.stringify(updateDto)}&#x60;);
    const file &#x3D; await this.fileRepository.findOne({ where: { id } });
    if (!file) {
      this.logger.warn(&#x60;File not found for update: ${id}&#x60;);
      return null;
    }

    // Zod validation for update
    try {
      FileUploadSchema.partial().parse(updateDto);
    } catch (err) {
      this.logger.error(&quot;Zod validation failed on update&quot;, err instanceof ZodError ? err.message : err);
      throw new BadRequestException(&quot;File update data validation failed&quot;, {
        description: &quot;Update data does not match schema&quot;,
        cause: err,
      });
    }

    Object.assign(file, updateDto);
    await this.fileRepository.save(file);

    this.logger.log(&#x60;File updated: ${file.id}&#x60;);
    return file;
  }

  /**
   * Updates file metadata for a specific user using UpdateMulterDto.
   *
   * Validates update data with Zod and class-validator, then updates the file record in the database.
   *
   * @param id File ID.
   * @param updateDto UpdateMulterDto instance containing partial file metadata.
   * @param userUuid UUID of the user associated with the file.
   * @returns Updated file or null if not found.
   * @throws {BadRequestException} If update data is invalid.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const updateDto &#x3D; new UpdateMulterDto();
   * updateDto.name &#x3D; &quot;new.txt&quot;;
   * const updated &#x3D; await fileUploadService.updateFileForUser(1, updateDto, &quot;user-uuid&quot;);
   * &#x60;&#x60;&#x60;
   *
   * @see {@link https://docs.nestjs.com/techniques/validation NestJS Validation}
   * @see {@link https://typeorm.io/#/repository-api TypeORM Repository API}
   */
  async updateFileForUser(id: number, updateDto: UpdateMulterDto, userUuid: string) {
    this.logger.debug(&#x60;updateFileForUser called with id: ${id}, userUuid: ${userUuid}, data: ${JSON.stringify(updateDto)}&#x60;);
    const file &#x3D; await this.fileRepository.findOne({ where: { id, userUuid } });
    if (!file) {
      this.logger.warn(&#x60;File not found for update: ${id}&#x60;);
      return null;
    }

    // Zod validation for update
    try {
      FileUploadSchema.partial().parse(updateDto);
    } catch (err) {
      this.logger.error(&quot;Zod validation failed on update&quot;, err instanceof ZodError ? err.message : err);
      throw new BadRequestException(&quot;File update data validation failed&quot;, {
        description: &quot;Update data does not match schema&quot;,
        cause: err,
      });
    }

    Object.assign(file, updateDto);
    await this.fileRepository.save(file);

    this.logger.log(&#x60;File updated: ${file.id}&#x60;);
    return file;
  }

  /**
   * Deletes a file by its ID.
   *
   * Removes the file record from the database.
   *
   * @param id File ID.
   * @returns True if deleted, false otherwise.
   *
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const deleted &#x3D; await fileUploadService.deleteFile(1);
   * &#x60;&#x60;&#x60;
   */
  async deleteFile(id: number) {
    this.logger.debug(&#x60;deleteFile called with id: ${id}&#x60;);
    const result &#x3D; await this.fileRepository.delete(id);
    if (result.affected &#x3D;&#x3D;&#x3D; 0) {
      this.logger.warn(&#x60;File not found for deletion: ${id}&#x60;);
      return false;
    }
    this.logger.log(&#x60;File deleted: ${id}&#x60;);
    return true;
  }

  async deleteFileForUser(id: number, userUuid: string) {
    this.logger.debug(&#x60;deleteFileForUser called with id: ${id}, userUuid: ${userUuid}&#x60;);
    const result &#x3D; await this.fileRepository.delete({ id, userUuid });
    if (result.affected &#x3D;&#x3D;&#x3D; 0) {
      this.logger.warn(&#x60;File not found for deletion: ${id}&#x60;);
      return false;
    }
    this.logger.log(&#x60;File deleted: ${id}&#x60;);
    return true;
  }

  /**
   * Replaces the physical file for a given file ID and user UUID.
   *
   * Deletes the old file from disk and saves the new one, updating metadata in the database.
   *
   * @param id File ID.
   * @param file New file to replace the old one.
   * @param userUuid User UUID.
   * @returns Updated file metadata or null if not found.
   * @throws {BadRequestException} If file is invalid.
   */
  async replaceFile(id: number, file: Express.Multer.File, userUuid: string) {
    this.logger.debug(&#x60;replaceFile called with id: ${id}, userUuid: ${userUuid}, file: ${file?.originalname}&#x60;);
    const fileEntity &#x3D; await this.fileRepository.findOne({ where: { id, userUuid } });
    if (!fileEntity) {
      this.logger.warn(&#x60;File not found for replacement: ${id}&#x60;);
      return null;
    }

    // Delete old physical file
    try {
      await fs.unlink(path.resolve(fileEntity.path));
    } catch (err: any) {
      this.logger.error(&#x60;Error deleting old file: ${err.message}&#x60;);
      // Continue even if file does not exist
    }

    // Validate new file
    const allowedMimeTypes &#x3D; [&quot;image/jpeg&quot;, &quot;image/png&quot;, &quot;application/pdf&quot;];
    if (!allowedMimeTypes.includes(file.mimetype)) {
      this.logger.warn(&#x60;Invalid file type: ${file.mimetype}&#x60;);
      throw new BadRequestException(&quot;Invalid file type&quot;, {
        description: &quot;Allowed file types are: JPEG, PNG, PDF.&quot;,
        cause: &quot;File type not supported&quot;,
      });
    }
    const maxSize &#x3D; 5 * 1024 * 1024;
    if (file.size &gt; maxSize) {
      this.logger.warn(&#x60;File too large: ${file.size}&#x60;);
      throw new BadRequestException(&quot;File is too large!&quot;, {
        description: &quot;File size must be less than 5MB.&quot;,
        cause: &quot;File size exceeded&quot;,
      });
    }

    // Zod validation
    try {
      FileUploadSchema.parse({
        name: file.originalname,
        path: file.path,
        mimeType: file.mimetype,
        size: String(file.size),
        checksum: &quot;simulated-checksum&quot;,
      });
    } catch (err) {
      this.logger.error(&quot;Zod validation failed&quot;, err instanceof ZodError ? err.message : err);
      throw new BadRequestException(&quot;File data validation failed&quot;, {
        description: &quot;File data does not match schema&quot;,
        cause: err,
      });
    }

    // Update metadata
    fileEntity.name &#x3D; file.originalname;
    fileEntity.path &#x3D; file.path;
    fileEntity.mimeType &#x3D; file.mimetype;
    fileEntity.size &#x3D; String(file.size);
    fileEntity.checksum &#x3D; &quot;simulated-checksum&quot;;
    await this.fileRepository.save(fileEntity);

    this.logger.log(&#x60;File replaced and updated: ${fileEntity.id}&#x60;);
    return fileEntity;
  }

  /**
   * Returns the history (versions) of a file.
   *
   * If versioning is not implemented, returns only the current version.
   *
   * @param id File ID.
   * @param userUuid User UUID.
   * @returns Array of file versions metadata.
   */
  async getFileHistory(id: number, userUuid: string) {
    this.logger.debug(&#x60;getFileHistory called with id: ${id}, userUuid: ${userUuid}&#x60;);
    // Simulate versioning: return only current version
    const file &#x3D; await this.fileRepository.findOne({ where: { id, userUuid } });
    if (!file) {
      this.logger.warn(&#x60;File not found for history: ${id}&#x60;);
      return [];
    }
    // If you have a version table, fetch all versions here
    return [file];
  }

  /**
   * Generates a temporary share link for a file.
   *
   * Creates a unique token and returns a link for temporary download.
   *
   * @param id File ID.
   * @param userUuid User UUID.
   * @returns Temporary share link or null if file not found.
   */
  async generateShareLink(id: number, userUuid: string) {
    this.logger.debug(&#x60;generateShareLink called with id: ${id}, userUuid: ${userUuid}&#x60;);
    const file &#x3D; await this.fileRepository.findOne({ where: { id, userUuid } });
    if (!file) {
      this.logger.warn(&#x60;File not found for share link: ${id}&#x60;);
      return null;
    }
    // Generate a random token
    const token &#x3D; crypto.randomBytes(24).toString(&quot;hex&quot;);
    // Simulate storing token and expiration (implement persistent storage if needed)
    // For now, just return the link
    const baseUrl &#x3D; process.env.BASE_URL || &quot;http://localhost:3000&quot;;
    const expiresInMinutes &#x3D; 60;
    // You should store {token, fileId, userUuid, expiresAt} in a DB for real implementation
    return &#x60;${baseUrl}/users/files/shared/${token}?expires&#x3D;${Date.now() + expiresInMinutes * 60000}&#x60;;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'FileUploadService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
