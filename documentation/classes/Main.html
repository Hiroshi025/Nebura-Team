<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nebura-control documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">nebura-control documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Classes</li>
  <li class="breadcrumb-item" >Main</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/main.ts</code>
        </p>






            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logger" >logger</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#init" >init</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#moduleApp" >moduleApp</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor()</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">src/main.ts:40</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Constructs the Main class and sets the logger context to &quot;Main&quot;.</p>
<p>This ensures that all logs from this class are properly tagged.</p>
</div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../injectables/Logger.html" target="_self" >Logger</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(Main.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">src/main.ts:40</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Logger instance for application-wide logging.
Used to log messages and errors throughout the application lifecycle.</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="init"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>init</b></span>
                        <a href="#init"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>init()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="231"
                                    class="link-to-prism">src/main.ts:231</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Initializes the database connection and starts the API application.</p>
<p>This method is the main entry point for starting the Nebura API.
It calls the internal moduleApp method to configure and launch the application,
and logs a success message upon successful startup.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">const main = new Main();
await main.init();</code></pre></div></div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Resolves when the application is running.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="moduleApp"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>moduleApp</b></span>
                        <a href="#moduleApp"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>moduleApp()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="78"
                                    class="link-to-prism">src/main.ts:78</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Initializes and configures the main NestJS application module.</p>
<p>This method performs the following main steps:</p>
<ol>
<li>Creates the NestJS application with a custom logger.</li>
<li>Applies global validation pipes for request validation.</li>
<li>Enables URI-based API versioning with the prefix &#39;v&#39;.</li>
<li>Configures the folder for static files and the view engine.</li>
<li>Sets up Swagger documentation for the API.</li>
<li>Applies Helmet middleware for enhanced HTTP security.</li>
<li>Starts the application on the specified port.</li>
</ol>
<p>Example usage:</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">const main = new Main();
await main.init();
// Access API: http://localhost:3000/v1/your-endpoint
// Access Swagger UI: http://localhost:3000/v1/docs
// Download Swagger JSON: http://localhost:3000/v1/docs/download</code></pre></div><p>See <a href="https://docs.nestjs.com/techniques/validation">ValidationPipe</a>
See <a href="https://docs.nestjs.com/techniques/versioning">API Versioning</a>
See <a href="https://docs.nestjs.com/openapi/introduction">SwaggerModule</a>
See <a href="https://helmetjs.github.io/">Helmet</a></p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Resolves when the application is successfully started.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { registerHelpers } from &quot;#shared/utils/helpers&quot;;
import session from &quot;express-session&quot;;
import hbs from &quot;hbs&quot;;
import helmet from &quot;helmet&quot;;
import passport from &quot;passport&quot;;
import { join } from &quot;path&quot;;
import { loadEnvFile } from &quot;process&quot;;

import { ConsoleLogger, Logger, ValidationPipe, VersioningType } from &quot;@nestjs/common&quot;;
import { NestFactory } from &quot;@nestjs/core&quot;;
import { NestExpressApplication } from &quot;@nestjs/platform-express&quot;;
import { DocumentBuilder, SwaggerModule } from &quot;@nestjs/swagger&quot;;

import { AppModule } from &quot;./app.module&quot;;

/**
 * Main class responsible for initializing and starting the Nebura API application.
 *
 * This class orchestrates the setup of the NestJS application, including:
 * - Enabling API versioning via URI prefix.
 * - Initializing the database connection.
 * - Configuring Swagger documentation for API endpoints.
 * - Applying security middleware (Helmet).
 * - Setting up global validation pipes.
 * - Managing application logging.
 *
 * @see {@link https://docs.nestjs.com/ NestJS Documentation}
 * @see {@link https://docs.nestjs.com/openapi/introduction NestJS Swagger}
 * @see {@link https://docs.nestjs.com/techniques/database NestJS TypeORM}
 * @see {@link https://docs.nestjs.com/techniques/logger Logger}
 * @see {@link https://helmetjs.github.io/ Helmet}
 */
loadEnvFile();
export class Main {
  /**
   * Logger instance for application-wide logging.
   * Used to log messages and errors throughout the application lifecycle.
   * @type {Logger}
   */
  public readonly logger: Logger &#x3D; new Logger(Main.name);

  /**
   * Constructs the Main class and sets the logger context to &quot;Main&quot;.
   *
   * This ensures that all logs from this class are properly tagged.
   */
  constructor() {}

  /**
   * Initializes and configures the main NestJS application module.
   *
   * This method performs the following main steps:
   * 1. Creates the NestJS application with a custom logger.
   * 2. Applies global validation pipes for request validation.
   * 3. Enables URI-based API versioning with the prefix &#x27;v&#x27;.
   * 4. Configures the folder for static files and the view engine.
   * 5. Sets up Swagger documentation for the API.
   * 6. Applies Helmet middleware for enhanced HTTP security.
   * 7. Starts the application on the specified port.
   *
   * Example usage:
   * &#x60;&#x60;&#x60;typescript
   * const main &#x3D; new Main();
   * await main.init();
   * // Access API: http://localhost:3000/v1/your-endpoint
   * // Access Swagger UI: http://localhost:3000/v1/docs
   * // Download Swagger JSON: http://localhost:3000/v1/docs/download
   * &#x60;&#x60;&#x60;
   *
   * @private
   * @returns {Promise&lt;void&gt;} Resolves when the application is successfully started.
   *
   * @see {@link https://docs.nestjs.com/techniques/validation ValidationPipe}
   * @see {@link https://docs.nestjs.com/techniques/versioning API Versioning}
   * @see {@link https://docs.nestjs.com/openapi/introduction SwaggerModule}
   * @see {@link https://helmetjs.github.io/ Helmet}
   */
  private async moduleApp(): Promise&lt;void&gt; {
    // 1. Create the NestJS application with a custom logger
    //    - Uses ConsoleLogger for colored output in development.
    //    - See: https://docs.nestjs.com/fundamentals/logging
    const app &#x3D; await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, {
      logger: process.env.NODE_ENV &#x3D;&#x3D;&#x3D; &quot;development&quot; ? new ConsoleLogger({ colors: true }) : false,
      bufferLogs: true,
    });

    // 2. Apply global validation pipes
    //    - Ensures all incoming requests are validated.
    //    - See: https://docs.nestjs.com/techniques/validation
    app.useGlobalPipes(
      new ValidationPipe({
        enableDebugMessages: true,
        whitelist: true, // Strip properties that do not have decorators
        forbidNonWhitelisted: true, // Throw error if non-whitelisted properties are present
        transform: true, // Automatically transform payloads to DTO instances
      }),
    );

    // 3. Enable API versioning by URI
    //    - Allows endpoints like /v1/your-endpoint
    //    - See: https://docs.nestjs.com/techniques/versioning
    app.enableVersioning({
      type: VersioningType.URI,
      prefix: &quot;api/v&quot;,
    });

    // 4. Configure static files and view engine
    //    - Serves static assets from /interfaces/http/views/public
    //    - Sets Handlebars (hbs) as the view engine
    //    - See: https://docs.nestjs.com/techniques/mvc
    app.useStaticAssets(join(__dirname, &quot;..&quot;, &quot;web&quot;, &quot;public&quot;));
    app.setBaseViewsDir(join(__dirname, &quot;..&quot;, &quot;web&quot;, &quot;views&quot;));
    app.useStaticAssets(join(process.cwd(), &quot;documentation&quot;), {
      prefix: &quot;/docs&quot;,
    });

    app.setViewEngine(&quot;hbs&quot;);

    registerHelpers(hbs);
    hbs.registerPartials(join(__dirname, &quot;..&quot;, &quot;web&quot;, &quot;views&quot;, &quot;partials&quot;));
    hbs.registerHelper(&#x27;inc&#x27;, function(value) { return parseInt(value) + 1; });
    hbs.localsAsTemplateData(app);
    hbs.registerHelper(&quot;json&quot;, function (context) {
      return JSON.stringify(context, null, 2);
    });
    
    // 5. Configure Swagger for API documentation
    //    - Interactive API docs at /v1/docs
    //    - Downloadable OpenAPI JSON at /v1/docs/download
    //    - JWT Bearer authentication enabled
    //    - See: https://docs.nestjs.com/openapi/introduction
    const swaggerApp &#x3D; new DocumentBuilder()
      .setTitle(&quot;Nebura API&quot;)
      .setDescription(&quot;API documentation for the Nebura application&quot;)
      .setVersion(&quot;1.0&quot;)
      .addSecurity(&quot;bearer&quot;, {
        type: &quot;http&quot;,
        scheme: &quot;bearer&quot;,
        bearerFormat: &quot;JWT&quot;,
        description: &quot;Enter JWT token in the format: Bearer &lt;token&gt;&quot;,
      })
      .addServer(&quot;http://localhost:3000&quot;, &quot;Local development server&quot;)
      .addGlobalResponse({
        status: 500,
        description: &quot;Internal Server Error&quot;,
      })
      .build();

    const documentFactory &#x3D; () &#x3D;&gt;
      SwaggerModule.createDocument(app, swaggerApp, {
        operationIdFactory: (controllerKey: string, methodKey: string) &#x3D;&gt; &#x60;${controllerKey}_${methodKey}&#x60;,
        autoTagControllers: true,
        linkNameFactory: (controllerKey: string, methodKey: string, fieldKey: string) &#x3D;&gt;
          &#x60;${controllerKey}_${methodKey}_${fieldKey}&#x60;,
        ignoreGlobalPrefix: false,
        deepScanRoutes: true,
        extraModels: [],
      });
    SwaggerModule.setup(&quot;v1/docs&quot;, app, documentFactory, {
      jsonDocumentUrl: &quot;v1/docs/download&quot;,
      swaggerOptions: {
        displayRequestDuration: true,
        persistAuthorization: true,
        docExpansion: &quot;list&quot;,
      },
      customSiteTitle: process.env.SWAGGER_TITLE,
      customfavIcon: process.env.SWAGGER_FAVICON_URL,
      customCssUrl: &quot;/css/swagger.css&quot;,
      explorer: true,
      swaggerUiEnabled: true,
    });

    // 6. Apply Helmet middleware for HTTP security
    //    - Sets various HTTP headers for security best practices
    //    - CSP and COEP are disabled for development simplicity
    //    - See: https://helmetjs.github.io/
    app.use(
      helmet({
        contentSecurityPolicy: false, // CSP disabled for simplicity
        crossOriginEmbedderPolicy: false, // COEP disabled for simplicity
      }),
    );

    // 7. Configure session management with express-session
    //    - Uses a secret from environment variables or a default value
    //    - Sets session cookie max age to 1 hour
    //    - See: https://www.npmjs.com/package/express-session
    app.use(
      session({
        secret: (process.env.SESSION_SECRET as string) || &quot;default_session_secret&quot;,
        resave: false,
        saveUninitialized: false,
        cookie: {
          maxAge: 86400000, // 1 día
          secure: process.env.NODE_ENV &#x3D;&#x3D;&#x3D; &quot;production&quot;, // HTTPS en producción
        },
        // eslint-disable-next-line @typescript-eslint/no-require-imports, @typescript-eslint/no-unsafe-call
        store: new (require(&quot;connect-sqlite3&quot;)(session))({
          db: &#x60;sessions.sqlite&#x60;,
          dir: &quot;./src/adapters/database&quot;,
        }),
      }),
    );

    app.use(passport.initialize());
    app.use(passport.session());

    // 8. Start the application on the specified port
    //    - Default: 3000, or use process.env.PORT
    //    - Logs the URL for API and Swagger UI
    //app.useGlobalGuards(new RolesGuard());
    const port &#x3D; process.env.PORT ? parseInt(process.env.PORT, 10) : 3000;
    await app.listen(port, &quot;0.0.0.0&quot;);
    this.logger.log(&#x60;Nebura API is running at http://localhost:${port}/v1/&#x60;);
    this.logger.log(&#x60;Swagger UI available at http://localhost:${port}/v1/docs&#x60;);
  }

  /**
   * Initializes the database connection and starts the API application.
   *
   * This method is the main entry point for starting the Nebura API.
   * It calls the internal moduleApp method to configure and launch the application,
   * and logs a success message upon successful startup.
   *
   * @returns {Promise&lt;void&gt;} Resolves when the application is running.
   *
   * @example
   * const main &#x3D; new Main();
   * await main.init();
   */
  public async init(): Promise&lt;void&gt; {
    await this.moduleApp();
    this.logger.log(&quot;Application API successfully on port &quot; + (process.env.PORT ?? 3000));
  }
}

/**
 * Entry point for the Nebura API application.
 *
 * This code creates an instance of the Main class and starts the initialization process.
 * If the application fails to start, it logs the error using the custom logger and outputs it to the console.
 *
 * @see {@link https://docs.nestjs.com/ NestJS Documentation}
 * @example
 * // Run the application
 * node dist/main.js
 */
export const main &#x3D; new Main();
main.init().catch((error) &#x3D;&gt; {
  main.logger.error(&quot;Application failed to start&quot;, error);
  console.log(error);
});
</code></pre>
    </div>
</div>









                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'Main.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
